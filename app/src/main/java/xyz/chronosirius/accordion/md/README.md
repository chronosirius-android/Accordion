Again I must borrow someone else's code, but because of bad packaging, I cannot include it like a normal dependency.

see https://github.com/xavier-tobin/PatternAnnotatedString for the original source of this code.